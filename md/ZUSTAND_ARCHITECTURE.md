# ğŸ—ï¸ Zustand Architecture Diagram

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USER INTERFACE LAYER                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   HERO SECTION   â”‚   â”‚  RESULTS CARDS   â”‚   â”‚      MAP VIEW    â”‚   â”‚
â”‚  â”‚                  â”‚   â”‚                  â”‚   â”‚                  â”‚   â”‚
â”‚  â”‚ â€¢ Search Input   â”‚   â”‚ â€¢ Store Cards    â”‚   â”‚ â€¢ Map Container  â”‚   â”‚
â”‚  â”‚ â€¢ Radius Select  â”‚   â”‚ â€¢ Selection UI   â”‚   â”‚ â€¢ Markers        â”‚   â”‚
â”‚  â”‚ â€¢ Search Button  â”‚   â”‚ â€¢ Store Info     â”‚   â”‚ â€¢ Routes         â”‚   â”‚
â”‚  â”‚                  â”‚   â”‚                  â”‚   â”‚                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                      â”‚                      â”‚               â”‚
â”‚           â”‚ onSearch()           â”‚ onSelect()           â”‚ onSelect()    â”‚
â”‚           â”‚                      â”‚                      â”‚               â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                  â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      HOME COMPONENT (Controller)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â€¢ Handles search & location detection                                  â”‚
â”‚  â€¢ Manages component rendering                                          â”‚
â”‚  â€¢ Passes props to child components                                     â”‚
â”‚  â€¢ Initializes state from sessionStorage                                â”‚
â”‚                                                                           â”‚
â”‚  const query = useSearchStore(state => state.query)                    â”‚
â”‚  const selectStore = useSearchStore(state => state.selectStore)        â”‚
â”‚  const searchProducts = useSearchStore(state => state.searchProducts)   â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                                  â”‚
             â”‚ set({ query, stores, selectedStore, ... })     â”‚
             â”‚                                                  â”‚
             â†“                                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ZUSTAND STATE STORE            â”‚   â”‚  BROWSER SESSIONSTRORAGE     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                  â”‚   â”‚ Key: "involv-search-state"   â”‚
â”‚  STATE:                          â”‚   â”‚                              â”‚
â”‚  â€¢ query: ""                     â”‚   â”‚ Contains:                    â”‚
â”‚  â€¢ stores: []                    â”‚   â”‚ {query, stores,              â”‚
â”‚  â€¢ selectedStore: null           â”‚   â”‚  selectedStore, view,        â”‚
â”‚  â€¢ userLocation: null            â”‚   â”‚  userLocation}               â”‚
â”‚  â€¢ view: "split"                 â”‚   â”‚                              â”‚
â”‚  â€¢ loading: false                â”‚   â”‚ Auto-updated when:           â”‚
â”‚  â€¢ error: null                   â”‚   â”‚ â€¢ searchProducts() completes â”‚
â”‚  â€¢ hasSearched: false            â”‚   â”‚ â€¢ selectStore() called       â”‚
â”‚                                  â”‚   â”‚ â€¢ setView() called           â”‚
â”‚  ACTIONS:                        â”‚   â”‚                              â”‚
â”‚  â€¢ searchProducts()              â”‚   â”‚ Auto-loaded on:              â”‚
â”‚  â€¢ selectStore()                 â”‚   â”‚ â€¢ App start via              â”‚
â”‚  â€¢ setView()                     â”‚   â”‚   initializeFromStorage()    â”‚
â”‚  â€¢ setUserLocation()             â”‚   â”‚                              â”‚
â”‚  â€¢ clearSearch()                 â”‚   â”‚ Auto-cleared:                â”‚
â”‚  â€¢ initializeFromStorage()       â”‚   â”‚ â€¢ clearSearch() called       â”‚
â”‚                                  â”‚   â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ 1. API Call needed?
             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”
             â”‚                                   â”‚
             â”‚ 2. Get location (lat, lng)        â”‚
             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”
             â”‚                                   â”‚
             â”‚ 3. Call searchNearbyProducts API  â”‚
             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”
             â”‚                                   â”‚
             â”‚ 4. Normalize response             â”‚
             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”
             â”‚                                   â†“
             â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                        â”‚   BACKEND API        â”‚
             â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
             â”‚                        â”‚                      â”‚
             â”‚                        â”‚ searchProductNearby: â”‚
             â”‚                        â”‚ â€¢ Geo search         â”‚
             â”‚                        â”‚ â€¢ Atlas search       â”‚
             â”‚                        â”‚ â€¢ Distance calc      â”‚
             â”‚                        â”‚ â€¢ Caching            â”‚
             â”‚                        â”‚                      â”‚
             â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Returns:             â”‚
             â”‚   Normalized           â”‚ [{store, product,    â”‚
             â”‚   Store Data           â”‚   distance, ...}]    â”‚
             â”‚                        â”‚                      â”‚
             â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â†’ set({ stores: normalized, loading: false })
             â”‚
             â””â”€â†’ sessionStorage.setItem()
```

---

## Data Flow Diagram

### Complete Search Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           USER SEARCHES                                  â”‚
â”‚                                                                           â”‚
â”‚              User types "Electronics" and clicks Search                 â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        HERO onSearch CALLBACK                           â”‚
â”‚                                                                           â”‚
â”‚  {productName: "Electronics", radius: 5000}                             â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HOME handleSearch FUNCTION                           â”‚
â”‚                                                                           â”‚
â”‚  â€¢ Check if userLocation exists                                         â”‚
â”‚  â€¢ If not, call getUserLocation()                                       â”‚
â”‚  â€¢ Validate location is valid                                           â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ZUSTAND searchProducts ACTION STARTS                        â”‚
â”‚                                                                           â”‚
â”‚  set({ loading: true, error: null, hasSearched: true })                 â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API CALL: searchNearbyProducts                        â”‚
â”‚                                                                           â”‚
â”‚  POST /search/product                                                    â”‚
â”‚  Body: {                                                                â”‚
â”‚    productName: "Electronics",                                          â”‚
â”‚    lat: 28.6139,                                                        â”‚
â”‚    lng: 77.2090,                                                        â”‚
â”‚    radius: 5000                                                         â”‚
â”‚  }                                                                      â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BACKEND PROCESSING                                  â”‚
â”‚                                                                           â”‚
â”‚  â€¢ Check Redis cache                                                    â”‚
â”‚  â€¢ Perform geo-spatial search on vendors                                â”‚
â”‚  â€¢ Perform Atlas full-text search on products                           â”‚
â”‚  â€¢ Filter by stock > 0                                                  â”‚
â”‚  â€¢ Merge vendor info with product data                                  â”‚
â”‚  â€¢ Calculate distances                                                  â”‚
â”‚  â€¢ Sort by distance (nearest first)                                     â”‚
â”‚  â€¢ Cache result in Redis                                                â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API RETURNS RESULTS                                   â”‚
â”‚                                                                           â”‚
â”‚  {                                                                      â”‚
â”‚    success: true,                                                       â”‚
â”‚    data: [                                                              â”‚
â”‚      {                                                                  â”‚
â”‚        productImage: [...],                                            â”‚
â”‚        productName: "Laptop",                                          â”‚
â”‚        productCategory: "electronics",                                 â”‚
â”‚        price: 45000,                                                   â”‚
â”‚        stock: 5,                                                       â”‚
â”‚        storeName: "Best Electronics",                                  â”‚
â”‚        phone: "9876543210",                                            â”‚
â”‚        address: "123 Main St",                                         â”‚
â”‚        location: {coordinates: [77.2090, 28.6139]},                   â”‚
â”‚        distance: 250                                                   â”‚
â”‚      },                                                                â”‚
â”‚      ...                                                               â”‚
â”‚    ]                                                                   â”‚
â”‚  }                                                                      â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ZUSTAND normalizeSearchResults FUNCTION                   â”‚
â”‚                                                                           â”‚
â”‚  Transform API response to component-friendly format:                   â”‚
â”‚  {                                                                      â”‚
â”‚    id: "Store1-0",                                                     â”‚
â”‚    image: "...",                                                       â”‚
â”‚    name: "Best Electronics",                                           â”‚
â”‚    phone: "9876543210",                                                â”‚
â”‚    address: "123 Main St",                                             â”‚
â”‚    distance: 250,                                                      â”‚
â”‚    latitude: 28.6139,                                                  â”‚
â”‚    longitude: 77.2090,                                                 â”‚
â”‚    product: {                                                          â”‚
â”‚      name: "Laptop",                                                   â”‚
â”‚      productCategory: "electronics",                                   â”‚
â”‚      price: 45000,                                                     â”‚
â”‚      stock: 5                                                          â”‚
â”‚    }                                                                   â”‚
â”‚  }                                                                      â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ZUSTAND SET STATE WITH NORMALIZED DATA                      â”‚
â”‚                                                                           â”‚
â”‚  set({                                                                  â”‚
â”‚    query: "Electronics",                                                â”‚
â”‚    userLocation: { lat: 28.6139, lng: 77.2090 },                        â”‚
â”‚    stores: [normalized store objects],                                  â”‚
â”‚    selectedStore: first_normalized_store,                               â”‚
â”‚    loading: false                                                       â”‚
â”‚  });                                                                    â”‚
â”‚                                                                           â”‚
â”‚  // SessionStorage automatically persists:                              â”‚
â”‚  sessionStorage.setItem("involv-search-state", JSON.stringify({...}));  â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   HOME COMPONENT RE-RENDERS                             â”‚
â”‚                                                                           â”‚
â”‚  Zustand selectors trigger re-render with new state:                    â”‚
â”‚  â€¢ query = "Electronics"                                                â”‚
â”‚  â€¢ stores = [5 store objects]                                           â”‚
â”‚  â€¢ selectedStore = first store                                          â”‚
â”‚  â€¢ loading = false                                                      â”‚
â”‚  â€¢ hasSearched = true                                                   â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CHILD COMPONENTS RECEIVE PROPS                         â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   STORECARD LIST  â”‚  â”‚   RESULTSMAP       â”‚  â”‚  VIEWTOGGLE      â”‚  â”‚
â”‚  â”‚                   â”‚  â”‚                    â”‚  â”‚                  â”‚  â”‚
â”‚  â”‚ â€¢ 5 cards render  â”‚  â”‚ â€¢ 5 markers show   â”‚  â”‚ â€¢ View options   â”‚  â”‚
â”‚  â”‚ â€¢ First selected  â”‚  â”‚ â€¢ First selected   â”‚  â”‚ â€¢ list/split/map â”‚  â”‚
â”‚  â”‚ â€¢ Scrolls to 1st  â”‚  â”‚ â€¢ Routes to 1st    â”‚  â”‚ â€¢ Default: split â”‚  â”‚
â”‚  â”‚                   â”‚  â”‚ â€¢ Popups on click  â”‚  â”‚                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  All passing:                                                           â”‚
â”‚  â€¢ store objects                                                        â”‚
â”‚  â€¢ selectedStore                                                        â”‚
â”‚  â€¢ onSelect: selectStore callback                                       â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER SEES RESULTS!                                â”‚
â”‚                                                                           â”‚
â”‚  [Map View]        [Store Cards]         [Other Sections]               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ [Map]    â”‚      â”‚Store 1   â”‚         â”‚ Nearby Alt.      â”‚            â”‚
â”‚  â”‚   â­    â”‚      â”‚âœ“Selected â”‚         â”‚ Area Insights    â”‚            â”‚
â”‚  â”‚   ğŸª    â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â”‚   ğŸ“    â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚Store 2   â”‚                                          â”‚
â”‚                    â”‚           â”‚                                          â”‚
â”‚  Route Line â”€â”€â†’   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         All interactive!                  â”‚
â”‚  User Location     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â€¢ Click store â†’ selects          â”‚
â”‚  Store Markers     â”‚Store 3   â”‚        â€¢ Click marker â†’ popup           â”‚
â”‚                    â”‚           â”‚        â€¢ Toggle view â†’ relayout        â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â€¢ Refresh page â†’ recovers        â”‚
â”‚                    Scrollable list    state from sessionStorage          â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Tree

```
â”Œâ”€ App.jsx
â”‚
â””â”€ Home.jsx (MAIN CONTROLLER)
   â”‚
   â”œâ”€ Navbar
   â”‚
   â”œâ”€ Hero.jsx (SEARCH INPUT)
   â”‚  â””â”€ props: onSearch, onDetectLocation
   â”‚
   â”œâ”€ [Conditional] When NOT hasSearched:
   â”‚  â”œâ”€ HowItWorks
   â”‚  â”œâ”€ WhyInVolvExists
   â”‚  â””â”€ TrustAndCTA
   â”‚
   â””â”€ [Conditional] When hasSearched:
      â”‚
      â”œâ”€ ViewToggle
      â”‚  â””â”€ props: view, setView
      â”‚
      â”œâ”€ [Grid Layout - depends on view mode]
      â”‚
      â”œâ”€ [LIST VIEW] (visible if view = "list" OR "split")
      â”‚  â”‚
      â”‚  â””â”€ StoreCard (mapped for each store)
      â”‚     â””â”€ props: store, isSelected, onSelect
      â”‚
      â”œâ”€ [MAP VIEW] (visible if view = "map" OR "split")
      â”‚  â”‚
      â”‚  â””â”€ ResultsMap
      â”‚     â”œâ”€ MapContainer (react-leaflet)
      â”‚     â”œâ”€ TileLayer
      â”‚     â”œâ”€ MapController (handles zoom/pan)
      â”‚     â”œâ”€ Marker (for each store)
      â”‚     â”‚  â””â”€ Popup (click to show store info)
      â”‚     â”œâ”€ RouteLayer (shows route line)
      â”‚     â””â”€ props: stores, selectedStore, onSelect
      â”‚
      â”œâ”€ SelectedStoreInsight (if selectedStore)
      â”‚  â””â”€ Shows details of selected store
      â”‚
      â”œâ”€ NearbyAlternatives
      â”‚  â””â”€ Shows alternative stores
      â”‚
      â”œâ”€ AreaInsights
      â”‚  â””â”€ Shows area statistics
      â”‚
      â””â”€ SearchFallback
         â””â”€ Suggestions for next search

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

STATE FLOW: Zustand Store
â”‚
â”œâ”€ query: string
â”œâ”€ stores: array<Store>
â”œâ”€ selectedStore: Store | null
â”œâ”€ userLocation: {lat, lng} | null
â”œâ”€ view: "list" | "split" | "map"
â”œâ”€ loading: boolean
â”œâ”€ error: string | null
â”œâ”€ hasSearched: boolean
â”‚
â””â”€ ACTIONS:
   â”œâ”€ searchProducts({productName, lat, lng, radius})
   â”œâ”€ selectStore(store)
   â”œâ”€ setView(view)
   â”œâ”€ setUserLocation(loc)
   â”œâ”€ clearSearch()
   â””â”€ initializeFromStorage()
```

---

## Prop Passing Pattern (Props-Based Architecture)

```
HOME (Zustand Consumer)
â”‚
â”œâ”€ Extracts State:
â”‚  â”œâ”€ query
â”‚  â”œâ”€ stores
â”‚  â”œâ”€ selectedStore
â”‚  â”œâ”€ loading
â”‚  â”œâ”€ view
â”‚  â”œâ”€ userLocation
â”‚  â””â”€ hasSearched
â”‚
â”œâ”€ Extracts Actions:
â”‚  â”œâ”€ searchProducts
â”‚  â”œâ”€ selectStore
â”‚  â”œâ”€ setView
â”‚  â”œâ”€ setUserLocation
â”‚  â””â”€ initializeFromStorage
â”‚
â”œâ”€ PASSES TO HERO:
â”‚  â”œâ”€ onSearch = handleSearch (calls searchProducts)
â”‚  â””â”€ onDetectLocation = handleDetectLocation (calls setUserLocation)
â”‚
â”œâ”€ PASSES TO STORECARD:
â”‚  â”œâ”€ store = individual store object
â”‚  â”œâ”€ onSelect = selectStore
â”‚  â”œâ”€ isSelected = (selectedStore?.id === store.id)
â”‚  â””â”€ index, variant (unchanged)
â”‚
â”œâ”€ PASSES TO RESULTSMAP:
â”‚  â”œâ”€ stores = stores array
â”‚  â”œâ”€ selectedStore = selectedStore object
â”‚  â”œâ”€ userLocation = userLocation object
â”‚  â”œâ”€ onSelect = selectStore
â”‚  â””â”€ onNavigate = selectStore
â”‚
â”œâ”€ PASSES TO VIEWTOGGLE:
â”‚  â”œâ”€ view = current view mode
â”‚  â””â”€ setView = toggles view
â”‚
â””â”€ PASSES TO ALTERNATIVES:
   â”œâ”€ stores = stores array
   â”œâ”€ selectedStore = selectedStore object
   â””â”€ onSelect = selectStore

KEY PRINCIPLE:
No child component directly uses Zustand!
All state comes from props.
Home is the only Zustand consumer.
âœ“ Clean separation of concerns
âœ“ Easy to test (props are mockable)
âœ“ Reusable components
```

---

## State Update Lifecycle

```
â”Œâ”€ Initial State (App Load)
â”‚  query: ""
â”‚  stores: []
â”‚  selectedStore: null
â”‚  userLocation: null
â”‚  view: "split"
â”‚  loading: false
â”‚  hasSearched: false
â”‚
â”œâ”€ initializeFromStorage() Called
â”‚  â””â”€ Check sessionStorage["involv-search-state"]
â”‚     â”œâ”€ If exists: Restore all values
â”‚     â””â”€ If not: Stay at initial state
â”‚
â”œâ”€ User Searches
â”‚  â”œâ”€ set({ loading: true, hasSearched: true })
â”‚  â”œâ”€ Call API
â”‚  â”œâ”€ Normalize results
â”‚  â”œâ”€ set({ stores: [...], selectedStore: first, loading: false })
â”‚  â””â”€ sessionStorage updated automatically
â”‚
â”œâ”€ User Selects Store
â”‚  â”œâ”€ selectStore(store) called
â”‚  â”œâ”€ set({ selectedStore: store })
â”‚  â””â”€ sessionStorage updated automatically
â”‚
â”œâ”€ User Toggles View
â”‚  â”œâ”€ setView(newView) called
â”‚  â”œâ”€ set({ view: newView })
â”‚  â””â”€ sessionStorage updated automatically
â”‚
â”œâ”€ Page Refreshed
â”‚  â”œâ”€ initializeFromStorage() restores from sessionStorage
â”‚  â””â”€ All previous state recovered
â”‚
â””â”€ User Clears Search
   â”œâ”€ clearSearch() called
   â”œâ”€ set({ query: "", stores: [], selectedStore: null, ... })
   â””â”€ sessionStorage.removeItem() called
```

---

**Architecture is clean, maintainable, and follows React best practices!**
